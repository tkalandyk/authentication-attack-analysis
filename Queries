# üîê Authentication Attack Analysis ‚Äî Investigation Queries

This document contains the KQL queries used during the investigation of abnormal authentication activity on the internet-exposed Windows VM **js-mde-test**.  
Each query represents a deliberate investigative pivot used to validate or disprove compromise following suspected brute-force authentication activity.

---

## ‚úÖ QUERY 1 ‚Äî Failed Authentication Attempts

**Purpose:**  
Identify the volume of failed logon attempts targeting the device to determine whether brute-force or password-guessing behavior occurred.

<details>
<summary>üîç View KQL Query</summary>

```kql
DeviceLogonEvents
| where ActionType == "LogonFailed"
| where DeviceName contains "js-mde-test"
| summarize FailedLogons = count() by DeviceName

</details>
Why this matters:
A high number of failed logons against an exposed endpoint is a strong indicator of brute-force or credential-stuffing activity.

‚úÖ QUERY 2 ‚Äî Successful Authentication Attempts
Purpose:
Determine whether any authentication attempts succeeded after the failed attempts, indicating potential credential compromise.

<details> <summary>üîç View KQL Query</summary>
kql
Copy code
DeviceLogonEvents
| where ActionType == "LogonSuccess"
| where DeviceName contains "js-mde-test"
| summarize SuccessfulLogons = count() by DeviceName
</details>
Why this matters:
A success following repeated failures is a classic brute-force pattern and represents a critical pivot point in the investigation.

‚úÖ QUERY 3 ‚Äî Successful Logons by Account
Purpose:
Identify which user accounts successfully authenticated, and determine timing and frequency of access.

<details> <summary>üîç View KQL Query</summary>
kql
Copy code
DeviceLogonEvents
| where ActionType == "LogonSuccess"
| where DeviceName contains "js-mde-test"
| summarize
    SuccessCount = count(),
    FirstSeen = min(TimeGenerated),
    LastSeen  = max(TimeGenerated)
  by AccountName
| order by SuccessCount desc
</details>
Why this matters:
This isolates the specific identity involved and helps distinguish legitimate use from suspicious access.

‚úÖ QUERY 4 ‚Äî Suspicious Tool Execution (Post-Authentication)
Purpose:
Identify execution of commonly abused binaries (LOLBins) after successful authentication under the specific user context.

<details> <summary>üîç View KQL Query</summary>
kql
Copy code
DeviceProcessEvents
| where DeviceName contains "js-mde-test"
| where Timestamp > datetime(2025-12-24T05:42:09.5813634Z)
| where AccountName == "josh"
| where FileName in~ (
  "powershell.exe","pwsh.exe","cmd.exe","wmic.exe","net.exe",
  "whoami.exe","nltest.exe","rundll32.exe","reg.exe","schtasks.exe",
  "sc.exe","bitsadmin.exe","certutil.exe","mshta.exe",
  "wscript.exe","cscript.exe"
)
| project
    Timestamp,
    AccountName,
    FileName,
    ProcessCommandLine,
    InitiatingProcessFileName
| order by Timestamp asc
</details>
Why this matters:
Attackers often use native Windows tools to blend in with normal activity after gaining access.
This query helps detect suspicious post-authentication behavior without relying on malware signatures.

‚úÖ QUERY 5 ‚Äî Post-Authentication Network Activity (PowerShell)
Purpose:
Determine whether PowerShell activity resulted in outbound network connections to suspicious or attacker-controlled infrastructure.

<details> <summary>üîç View KQL Query</summary>
kql
Copy code
DeviceNetworkEvents
| where DeviceName contains "js-mde-test"
| where Timestamp > datetime(2025-12-24T05:42:09.5813634Z)
| where InitiatingProcessFileName == "powershell.exe"
| project
    Timestamp,
    InitiatingProcessAccountName,
    InitiatingProcessFileName,
    RemoteIP,
    RemotePort,
    Protocol,
    RemoteUrl
| order by Timestamp asc

</details>
Why this matters:
Post-authentication outbound connections can indicate command-and-control (C2), payload download, or data exfiltration attempts.
